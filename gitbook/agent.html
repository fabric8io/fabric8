<!DOCTYPE HTML>
<html lang="en-US" manifest="./manifest.appcache">
    
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        
        <meta charset="UTF-8">
        <title>Agent | Fabric8 Documentation</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="https:">
        <meta name="description" content="Fabric8 User Guide and Reference Documentation">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="./git.html" />
        
        
        <link rel="prev" href="./profiles.html" />
        

        <meta property="og:title" content="Agent | Fabric8 Documentation">
        <meta property="og:site_name" content="Fabric8 Documentation">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/https:">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
        
    </head>
    <body>
        
        

        <link rel="stylesheet" href="gitbook/style.css">
        

    
    <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-anchors/plugin.css">
    


        
    <div class="book" data-github="https://github.com/fabric8io/fabric8" data-level="3.3" data-basepath="." data-revision="1403983446785">
    <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    
    <a href="http://fabric8.io/" target="_blank" class="btn pull-left home-bookmark" aria-label="GitHub home"><i class="fa fa-bookmark-o"></i></a>
    
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="btn-group btn-block">
        <button id="reduce-font-size" class="btn btn-default">A</button>
        <button id="enlarge-font-size" class="btn btn-default">A</button>
    </div>

    <ul class="list-group font-family-list">
        <li class="list-group-item" data-font="0">Serif</li>
        <li class="list-group-item" data-font="1">Sans</li>
    </ul>

    <div class="btn-group btn-group-xs btn-block color-theme-list">
        <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
        <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
        <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
    </div>
</div>

    </span>

    <!-- Actions Right -->
    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    

    
    <a href="https://github.com/https://github.com/fabric8io/fabric8/stargazers" target="_blank" class="btn pull-right count-star hidden-xs"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/https://github.com/fabric8io/fabric8/watchers" target="_blank" class="btn pull-right count-watch hidden-xs"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>
    

    <!-- Title -->
    <h1>
        <i class="fa fa-spinner fa-spin"></i>
        <a href="./" >Fabric8 Documentation</a>
    </h1>
</div>

    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        <li>
            <a href="http://fabric8.io/docs/index.html" target="blank" class="author-link">About the author</a>
        </li>
        

        
        
        <li>
            <a href="https://github.com/fabric8io/fabric8/issues?milestone=none&amp;state=closed" target="blank"class="issues-link">Questions and Issues</a>
        </li>
        

        
        
        <li>
            <a href="http://fabric8.io/contributing/index.html" target="blank" class="contribute-link">Edit and Contribute</a>
        </li>
        

        
        <li class="divider"></li>
        

        <li data-level="0" data-path="index.html">
            <a href="./"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
    
        <li class="chapter " data-level="1" data-path="overview.html">
            
            <a href="./overview.html">
                <i class="fa fa-check"></i> <b>1.</b> Introduction
            </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="overview.html">
            
            <a href="./overview.html">
                <i class="fa fa-check"></i> <b>1.1.</b> Overview
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="getStarted.html">
            
            <a href="./getStarted.html">
                <i class="fa fa-check"></i> <b>1.2.</b> Get Started
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="quickstarts.html">
            
            <a href="./quickstarts.html">
                <i class="fa fa-check"></i> <b>1.3.</b> QuickStarts
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="environmentVariables.html">
            
            <a href="./environmentVariables.html">
                <i class="fa fa-check"></i> <b>1.4.</b> Environment Variables
            </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="developer.html">
            
            <a href="./developer.html">
                <i class="fa fa-check"></i> <b>2.</b> Developing
            </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="developer.html">
            
            <a href="./developer.html">
                <i class="fa fa-check"></i> <b>2.1.</b> Developer Workflow
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="mavenPlugin.html">
            
            <a href="./mavenPlugin.html">
                <i class="fa fa-check"></i> <b>2.2.</b> Maven Plugin
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="debugging.html">
            
            <a href="./debugging.html">
                <i class="fa fa-check"></i> <b>2.3.</b> Debugging
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="continuousDeployment.html">
            
            <a href="./continuousDeployment.html">
                <i class="fa fa-check"></i> <b>2.4.</b> Continuous Deployment
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="migration.html">
            
            <a href="./migration.html">
                <i class="fa fa-check"></i> <b>2.5.</b> Migration
            </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="registry.html">
            
            <a href="./registry.html">
                <i class="fa fa-check"></i> <b>3.</b> Architecture
            </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="registry.html">
            
            <a href="./registry.html">
                <i class="fa fa-check"></i> <b>3.1.</b> Registry
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="profiles.html">
            
            <a href="./profiles.html">
                <i class="fa fa-check"></i> <b>3.2.</b> Profiles
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="agent.html">
            
            <a href="./agent.html">
                <i class="fa fa-check"></i> <b>3.3.</b> Agent
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="git.html">
            
            <a href="./git.html">
                <i class="fa fa-check"></i> <b>3.4.</b> Git
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="mavenProxy.html">
            
            <a href="./mavenProxy.html">
                <i class="fa fa-check"></i> <b>3.5.</b> Maven Proxy
            </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="microServices.html">
            
            <a href="./microServices.html">
                <i class="fa fa-check"></i> <b>4.</b> Containers
            </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="microServices.html">
            
            <a href="./microServices.html">
                <i class="fa fa-check"></i> <b>4.1.</b> Micro Services
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="javaContainer.html">
            
            <a href="./javaContainer.html">
                <i class="fa fa-check"></i> <b>4.2.</b> Java Container
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="processContainer.html">
            
            <a href="./processContainer.html">
                <i class="fa fa-check"></i> <b>4.3.</b> Process Container
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="springBootContainer.html">
            
            <a href="./springBootContainer.html">
                <i class="fa fa-check"></i> <b>4.4.</b> Spring Boot Container
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="docker.html">
            
            <a href="./docker.html">
                <i class="fa fa-check"></i> <b>4.5.</b> Docker
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="sshContainers.html">
            
            <a href="./sshContainers.html">
                <i class="fa fa-check"></i> <b>4.6.</b> SSH Containers
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="cloudContainers.html">
            
            <a href="./cloudContainers.html">
                <i class="fa fa-check"></i> <b>4.7.</b> Cloud Containers
            </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="gateway.html">
            
            <a href="./gateway.html">
                <i class="fa fa-check"></i> <b>5.</b> Features
            </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="gateway.html">
            
            <a href="./gateway.html">
                <i class="fa fa-check"></i> <b>5.1.</b> Gateway
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="requirements.html">
            
            <a href="./requirements.html">
                <i class="fa fa-check"></i> <b>5.2.</b> Requirements
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="rollingUpgrade.html">
            
            <a href="./rollingUpgrade.html">
                <i class="fa fa-check"></i> <b>5.3.</b> Rolling Upgrade
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="offlineRepo.html">
            
            <a href="./offlineRepo.html">
                <i class="fa fa-check"></i> <b>5.4.</b> Offline Repository
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="partition.html">
            
            <a href="./partition.html">
                <i class="fa fa-check"></i> <b>5.5.</b> Partition
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="processManager.html">
            
            <a href="./processManager.html">
                <i class="fa fa-check"></i> <b>5.6.</b> Process Manager
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="security.html">
            
            <a href="./security.html">
                <i class="fa fa-check"></i> <b>5.7.</b> Security
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.8" data-path="propertyResolver.html">
            
            <a href="./propertyResolver.html">
                <i class="fa fa-check"></i> <b>5.8.</b> Property Resolver
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.9" data-path="urlHandlers.html">
            
            <a href="./urlHandlers.html">
                <i class="fa fa-check"></i> <b>5.9.</b> URL Handlers
            </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="brokerTopology.html">
            
            <a href="./brokerTopology.html">
                <i class="fa fa-check"></i> <b>6.</b> Technologies
            </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="brokerTopology.html">
            
            <a href="./brokerTopology.html">
                <i class="fa fa-check"></i> <b>6.1.</b> Apache ActiveMQ
            </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1" data-path="brokerTopology.html">
            
            <a href="./brokerTopology.html">
                <i class="fa fa-check"></i> <b>6.1.1.</b> Broker Topology
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.1.2" data-path="brokerClients.html">
            
            <a href="./brokerClients.html">
                <i class="fa fa-check"></i> <b>6.1.2.</b> Broker Clients
            </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="dataTransform.html">
            
            <a href="./dataTransform.html">
                <i class="fa fa-check"></i> <b>6.2.</b> Apache Camel
            </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.2.1" data-path="dataTransform.html">
            
            <a href="./dataTransform.html">
                <i class="fa fa-check"></i> <b>6.2.1.</b> Data Transform
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2.2" data-path="camelEndpointAmq.html">
            
            <a href="./camelEndpointAmq.html">
                <i class="fa fa-check"></i> <b>6.2.2.</b> amq: endpoint
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2.3" data-path="camelEndpointFabric.html">
            
            <a href="./camelEndpointFabric.html">
                <i class="fa fa-check"></i> <b>6.2.3.</b> fabric: endpoint
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2.4" data-path="camelEndpointMaster.html">
            
            <a href="./camelEndpointMaster.html">
                <i class="fa fa-check"></i> <b>6.2.4.</b> master: endpoint
            </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="cxfFabric.html">
            
            <a href="./cxfFabric.html">
                <i class="fa fa-check"></i> <b>6.3.</b> Apache CXF
            </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.3.1" data-path="cxfFabric.html">
            
            <a href="./cxfFabric.html">
                <i class="fa fa-check"></i> <b>6.3.1.</b> CXF Fabric
            </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Generated using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 32.432432432432435%;min-width: 29.72972972972973%;"></div>
    </div>
    <div class="chapters">
    
        <a href="./index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="./overview.html" title="Overview" class="chapter done " data-progress="1.1" style="left: 2.7027027027027026%;"></a>
    
        <a href="./getStarted.html" title="Get Started" class="chapter done " data-progress="1.2" style="left: 5.405405405405405%;"></a>
    
        <a href="./quickstarts.html" title="QuickStarts" class="chapter done " data-progress="1.3" style="left: 8.108108108108109%;"></a>
    
        <a href="./environmentVariables.html" title="Environment Variables" class="chapter done " data-progress="1.4" style="left: 10.81081081081081%;"></a>
    
        <a href="./developer.html" title="Developer Workflow" class="chapter done " data-progress="2.1" style="left: 13.513513513513514%;"></a>
    
        <a href="./mavenPlugin.html" title="Maven Plugin" class="chapter done " data-progress="2.2" style="left: 16.216216216216218%;"></a>
    
        <a href="./debugging.html" title="Debugging" class="chapter done " data-progress="2.3" style="left: 18.91891891891892%;"></a>
    
        <a href="./continuousDeployment.html" title="Continuous Deployment" class="chapter done " data-progress="2.4" style="left: 21.62162162162162%;"></a>
    
        <a href="./migration.html" title="Migration" class="chapter done " data-progress="2.5" style="left: 24.324324324324323%;"></a>
    
        <a href="./registry.html" title="Registry" class="chapter done " data-progress="3.1" style="left: 27.027027027027028%;"></a>
    
        <a href="./profiles.html" title="Profiles" class="chapter done " data-progress="3.2" style="left: 29.72972972972973%;"></a>
    
        <a href="./agent.html" title="Agent" class="chapter done " data-progress="3.3" style="left: 32.432432432432435%;"></a>
    
        <a href="./git.html" title="Git" class="chapter  " data-progress="3.4" style="left: 35.13513513513514%;"></a>
    
        <a href="./mavenProxy.html" title="Maven Proxy" class="chapter  " data-progress="3.5" style="left: 37.83783783783784%;"></a>
    
        <a href="./microServices.html" title="Micro Services" class="chapter  " data-progress="4.1" style="left: 40.54054054054054%;"></a>
    
        <a href="./javaContainer.html" title="Java Container" class="chapter  " data-progress="4.2" style="left: 43.24324324324324%;"></a>
    
        <a href="./processContainer.html" title="Process Container" class="chapter  " data-progress="4.3" style="left: 45.945945945945944%;"></a>
    
        <a href="./springBootContainer.html" title="Spring Boot Container" class="chapter  " data-progress="4.4" style="left: 48.648648648648646%;"></a>
    
        <a href="./docker.html" title="Docker" class="chapter  " data-progress="4.5" style="left: 51.351351351351354%;"></a>
    
        <a href="./sshContainers.html" title="SSH Containers" class="chapter  " data-progress="4.6" style="left: 54.054054054054056%;"></a>
    
        <a href="./cloudContainers.html" title="Cloud Containers" class="chapter  " data-progress="4.7" style="left: 56.75675675675676%;"></a>
    
        <a href="./gateway.html" title="Gateway" class="chapter  " data-progress="5.1" style="left: 59.45945945945946%;"></a>
    
        <a href="./requirements.html" title="Requirements" class="chapter  " data-progress="5.2" style="left: 62.16216216216216%;"></a>
    
        <a href="./rollingUpgrade.html" title="Rolling Upgrade" class="chapter  " data-progress="5.3" style="left: 64.86486486486487%;"></a>
    
        <a href="./offlineRepo.html" title="Offline Repository" class="chapter  " data-progress="5.4" style="left: 67.56756756756756%;"></a>
    
        <a href="./partition.html" title="Partition" class="chapter  " data-progress="5.5" style="left: 70.27027027027027%;"></a>
    
        <a href="./processManager.html" title="Process Manager" class="chapter  " data-progress="5.6" style="left: 72.97297297297297%;"></a>
    
        <a href="./security.html" title="Security" class="chapter  " data-progress="5.7" style="left: 75.67567567567568%;"></a>
    
        <a href="./propertyResolver.html" title="Property Resolver" class="chapter  " data-progress="5.8" style="left: 78.37837837837837%;"></a>
    
        <a href="./urlHandlers.html" title="URL Handlers" class="chapter  " data-progress="5.9" style="left: 81.08108108108108%;"></a>
    
        <a href="./brokerTopology.html" title="Broker Topology" class="chapter  " data-progress="6.1.1" style="left: 83.78378378378379%;"></a>
    
        <a href="./brokerClients.html" title="Broker Clients" class="chapter  " data-progress="6.1.2" style="left: 86.48648648648648%;"></a>
    
        <a href="./dataTransform.html" title="Data Transform" class="chapter  " data-progress="6.2.1" style="left: 89.1891891891892%;"></a>
    
        <a href="./camelEndpointAmq.html" title="amq: endpoint" class="chapter  " data-progress="6.2.2" style="left: 91.89189189189189%;"></a>
    
        <a href="./camelEndpointFabric.html" title="fabric: endpoint" class="chapter  " data-progress="6.2.3" style="left: 94.5945945945946%;"></a>
    
        <a href="./camelEndpointMaster.html" title="master: endpoint" class="chapter  " data-progress="6.2.4" style="left: 97.29729729729729%;"></a>
    
        <a href="./cxfFabric.html" title="CXF Fabric" class="chapter  " data-progress="6.3.1" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_3">
                    
                        <h2 id="agent"><a name="agent" class="anchor" href="#agent"><span class="fa fa-link"></span></a>Agent</h2>
<p>The <em>agent</em> is the part of Fabric8 that is responsible for applying the profiles to containers. The <em>agent</em> can be run into any container and its role is to retrieve profile information from the registry and apply them locally.
In more details, the <em>agent</em> will retrieve the profiles and versions that are assigned to the container on which its running, reconfigure the container, calculate what needs to be installed, removed or updated on the container and finally perform those task.</p>
<p>In reality there are two modules involved in the process:</p>
<ul>
<li><strong>fabric-configadmin</strong> The configuration admin bridge. Translates the registry information into configuration.</li>
<li><strong>fabric-agent</strong> The deployment agent. Reads the translated configuration and provisions the container accordingly.</li>
</ul>
<p>Often the term <em>agent</em> refers to just the deployment agent (fabric-agent module), but this section of the documentation will cover both and provide detailed information about the role of each one of them.</p>
<h3 id="the-configuration-admin-bridge-fabric-configadmin-"><a name="the-configuration-admin-bridge-fabric-configadmin-" class="anchor" href="#the-configuration-admin-bridge-fabric-configadmin-"><span class="fa fa-link"></span></a>The configuration admin bridge (fabric-configadmin)</h3>
<p>The configuration admin bridge is responsible for bridging the zookeeper registry with the configuration admin service.
Once it connects to the zookeeper registry it will determine what version is assigned to the container, retrieve the version of profiles that are assigned to the container and translate them into configuration, which is then applied locally.</p>
<p>Note, that the profile contain two types of information:</p>
<ul>
<li><strong>Configuration information</strong><ul>
<li><strong>System configuration</strong></li>
<li><strong>OSGi configuration</strong></li>
</ul>
</li>
<li><strong>Provisioning information</strong><ul>
<li><strong>Bundles</strong></li>
<li><strong>Features</strong></li>
<li><strong>Fabs</strong></li>
</ul>
</li>
</ul>
<p>The configuration admin bridge will read all of them and create the OSGi configuration that represents them.
All the provisioning &amp; system information will go under the <strong>io.fabric8.agent</strong> pid. For containers that are assigned multiple profiles, or just use the profile hierarchy the overlay view of the profiles will be added to io.fabric8.agent <em>(There is a single pid even if we have multiple profiles)</em>.</p>
<p>All the OSGi configuration will just you the pid and key value pairs that have been added to the profile.</p>
<p>The bridge will also watch the registry for changes, so any change in the profiles that are assigned to the container will be <em>tracked</em> and will immediately be applied to the local OSGi configuration of the container.</p>
<h2 id="the-deployment-agent-fabric-agent-"><a name="the-deployment-agent-fabric-agent-" class="anchor" href="#the-deployment-agent-fabric-agent-"><span class="fa fa-link"></span></a>The deployment agent (fabric-agent)</h2>
<p>The deployment agent is listening for local configuration changes on the io.fabric8.agent pid. Any change in that configuration will trigger the <em>deployment agent</em>.
Once the <em>deployment agent</em> is triggered, it will read the whole <strong>io.fabric8.agent</strong> pid and calculate the bundles that the container should have installed.
If the profiles assigned to the container also contain features or fabs, the deployment agent will translate them to bundles in order to populate a full list of bundles that the container should use.
The next action of the <em>deployment agent</em> is to compare that list of bundles, with the list of bundles that are currently installed, in order to identify:</p>
<ul>
<li><strong>Bundles to Uninstall</strong></li>
<li><strong>Bundles to Install</strong></li>
<li><strong>Bundles to Update</strong></li>
</ul>
<p>Finally, it downloads all the missing parts and perform the installation / uninstallation of bundles.</p>
<h3 id="how-the-deployment-agent-downloads-artifacts"><a name="how-the-deployment-agent-downloads-artifacts" class="anchor" href="#how-the-deployment-agent-downloads-artifacts"><span class="fa fa-link"></span></a>How the deployment agent downloads artifacts</h3>
<p>The <em>deployment agent</em> is capable of downloading artifacts from two different types of maven repositories:</p>
<ul>
<li><strong>Registered Fabric Maven Proxies</strong> More information on <a href="fabric-maven-proxy.html">fabric maven proxies</a>.</li>
<li><strong>Configured Maven repositories</strong> Any maven repository that is configured on the profile.</li>
</ul>
<p>Priority is always give to the <a href="fabric-maven-proxy.html">fabric maven proxies</a>. If more than one is registered in the cluster they will be used in order from the oldest to the newest.</p>
<p>If the target artifact is not found, then the configured maven repositories will be used. The list of repositories can be retrieved from the <em>org.ops4j.pax.url.mvn.repositories</em> property of the <strong>io.fabric8.agent</strong> pid.</p>
<p>To change that list of repositories for a specific profile you can simply, you the <a href="commands/fabric-profile-edit.html">fabric:profile-edit</a> command:</p>
<pre><code>  fabric:profile-edit --pid io.fabric8.agent/org.ops4j.pax.url.mvn.repositories=http://repositorymanager.mylocalnetwork.net default
</code></pre><p>It is suggested to keep this configuration in one profile and have the rest of profiles inherit from it. The default profile, which is the root of all of the default profiles, seems the ideal place.</p>
<h3 id="configuring-the-download-thread-pool"><a name="configuring-the-download-thread-pool" class="anchor" href="#configuring-the-download-thread-pool"><span class="fa fa-link"></span></a>Configuring the download thread pool</h3>
<p>By default the <em>deployment agent</em> uses a thread pool for concurrent download of needed artifcats. The default size of the pool is 2 which you can reconfigure by configuring the option with key <code>io.fabric8.agent.download.threads</code> in the <code>etc\custom.properties</code> file. </p>
<p>For example to use 5 threads:</p>
<pre><code>io.fabric8.agent.download.threads=5
</code></pre><h3 id="no-container-restarts"><a name="no-container-restarts" class="anchor" href="#no-container-restarts"><span class="fa fa-link"></span></a>No container restarts</h3>
<p>It is important to clarify that during the process the container is kept alive, no restarts are needed. The only exception in this rule is when changing things that are related to the osgi framework or the system itself.</p>
<ul>
<li><strong>Changing the OSGi framework</strong></li>
<li><strong>Changing the framework configuration</strong></li>
</ul>
<p>So, in most cases the container will be kept alive, since those exceptions are extremely rare. Even when the container will need a restart, that will be done automatically by the <em>deployment agent</em> and after the restart the container will reconnect to the cluster without any manual intervention.</p>
<h3 id="monitoring-the-deployment-provisioning-status"><a name="monitoring-the-deployment-provisioning-status" class="anchor" href="#monitoring-the-deployment-provisioning-status"><span class="fa fa-link"></span></a>Monitoring the deployment / provisioning status</h3>
<p>Through the whole process of the deployment / provisioning, the <em>deployment agent</em> will store the state in the runtime registry, so that its available to the whole cluster.</p>
<p>The user is able at any time to see that status using the <a href="commands/fabric-container-list.html">fabric:container-list</a> command.</p>
<pre><code>    fabric:container-list

    [id]                           [version] [alive] [profiles]                     [provision status]
    root*                          1.0       true    fabric, fabric-ensemble-0000-1 success
    mq1                            1.0       true    mq                             success
    mq2                            1.0       true    mq                             downloading
    billing-broker                 1.0       true    billing                        success
        admin-console              1.0       true    web, admin-console             success
</code></pre><p>To have a real time view of the provisioning status, you can make use of the <strong>shell:watch</strong>, as described bellow</p>
<pre><code>    shell:watch fabric:container-list
</code></pre><p>Here is a small clip that demonstrates the use of the <a href="commands/fabric-container-list.html">fabric:container-list</a> while the containers are changing profiles and the deployment againsts starts provisioning.</p>
<object width="853" height="480"><param name="movie" value="http://www.youtube.com/v/uhZE3aSDYcM?version=3&amp;hl=en_US&amp;rel=0"><param name="allowFullScreen" value="true"><param name="allowscriptaccess" value="always"><embed src="http://www.youtube.com/v/uhZE3aSDYcM?version=3&amp;hl=en_US&amp;rel=0" type="application/x-shockwave-flash" width="853" height="480" allowscriptaccess="always" allowfullscreen="true"></object>

<h3 id="resolution-and-startup-ordering"><a name="resolution-and-startup-ordering" class="anchor" href="#resolution-and-startup-ordering"><span class="fa fa-link"></span></a>Resolution and Startup Ordering</h3>
<p>In order to successfully determine what needs to be installed and what needs to be removed, the fabric-agent will use the OBR resolver. The resolver will make sure that all requirements are meet.
The requirements are usually package requirements but can also be service requirements. The resolver will use the bundle headers to identify both:</p>
<ul>
<li>If a bundle specifies in its headers an Import-Package requirement, an other bundle with the corresponding Export-Package is required</li>
<li>If a bundle specifies in its headers an Import-Service requirement, an other bundle with the corresponding Export-Service is required</li>
</ul>
<p>The last point is really important, because blueprint users the have mandatory references of services in their blueprint descriptor, will automatically have the Import-Service headers in their bundle (assuming the use of maven-bundle-plugin).
If the bundle that exports that service doesn&apos;t explicitly specify it in its headers, then resolution will fail. Either the exporter bundle will have to add an Export-Service directive or the importer bundle will have to remove the Import-Service directive.</p>
<p>When the resolution is successful the fabric-agent will start the bundles. Even though you should try to avoid having requirements in the startup order of your bundles, the fabric-agent will attempt to start the bundles based on their expressed requirements and capabilities.
This will not solve all issues, especially in cases where asynchronous service registration is involved. The best way to deal with this kind of issues is to use OSGi services.</p>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="./profiles.html" class="navigation navigation-prev " aria-label="Previous page: Profiles"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./git.html" class="navigation navigation-next " aria-label="Next page: Git"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="gitbook/app.js"></script>
        

    
    <script src="http://cdn.mathjax.org/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
