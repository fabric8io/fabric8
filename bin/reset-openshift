#!/bin/sh

DIRNAME=`dirname "$0"`

echo "Killing openshift"
killall openshift

echo "Removing old OpenShift files"
rm -rf openshift.local.*

echo "Killing running docker images"
docker kill $(docker ps -q)
#docker rm $(docker ps -a -q)

# Turn on monitor mode.
set -m


echo "Restarting OpenShift"
#Â master has now updated to use --master for the URL of the master
#openshift start --listenAddr=$OPENSHIFT_HOST:8080 &
openshift start --master=http://$OPENSHIFT_HOST:8080 &

sleep 2

echo "installing fabric8"
openshift kube  apply -c $DIRNAME/../apps/fabric8.json
#openshift kube  apply -c https://raw.githubusercontent.com/fabric8io/fabric8/2.0/apps/fabric8.json


echo "INFO: Checking for Openshift Availability:"
while  ! curl -s -m 10  "http://dockerhost:5000/v1/_ping" > /dev/null;  do echo "DEBUG: Openshift REST layer not running yet." ; sleep 2s; done; 
echo "INFO: Openshift REST layer ready."

